##### Basic environment #####

export LANG=en_US.UTF-8
export LC_ALL=en_US.UTF-8
export KEYTIMEOUT=1

export VISUAL=/usr/bin/vim
export EDITOR=/usr/bin/vim

export STARSHIP_USER_ALIAS=$([[ "$USER" == "lab-s-yehudat" ]] && echo me || echo "$USER")

# Common PATH bits (Mac + Linux)
if [ -d /opt/homebrew/bin ]; then
  export PATH="/opt/homebrew/bin:/opt/homebrew/sbin:/home/`whoami`/.config:$PATH"
elif [ -d /usr/local/bin ]; then
  export PATH="/usr/local/bin:/usr/local/sbin:/home/`whoami`/.config:$PATH"
fi

##### History & options #####

HISTSIZE=50000
SAVEHIST=50000
HISTFILE="$HOME/.zsh_history"

setopt APPEND_HISTORY
setopt SHARE_HISTORY
setopt HIST_IGNORE_DUPS
setopt HIST_IGNORE_SPACE
setopt HIST_VERIFY

setopt AUTO_CD
setopt EXTENDED_GLOB
setopt NO_BEEP
setopt PROMPT_SUBST

bindkey -v   # vim-style keys

##### Completions & plugins #####

# --- Zsh completions (incl. custom ones like glow) ---
if [[ -d ~/.zsh/completions ]]; then
  fpath=(~/.zsh/completions $fpath)
fi

[[ -f ~/.zsh_functions.common ]] && source ~/.zsh_functions.common

[[ -f ~/.zsh_functions.macos ]] && source ~/.zsh_functions.macos

autoload -Uz compinit && compinit

# --- zsh-syntax-highlighting ---
for _zshl in \
  "${HOMEBREW_PREFIX:-/opt/homebrew}/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh" \
  /usr/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh; do
  [[ -f "$_zshl" ]] && { source "$_zshl"; break; }
done
unset _zshl

if command -v starship >/dev/null 2>&1; then
  eval "$(starship init zsh)"
fi

##### Local overrides #####
if [ -f "$HOME/.zshrc.local" ]; then
  source "$HOME/.zshrc.local"
fi
