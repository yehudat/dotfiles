" -*- vim: set filetype=vim : -*-
"
"================================================================
" 1. Encoding and leader key
"----------------------------------------------------------------
scriptencoding utf-8
set encoding=utf-8

" Use space as the <Leader> key for custom mappings
let mapleader = " "

"================================================================
" 2. Plugin management with Vundle
"   Always load plugins, even in terminal Vim, then wrap GUI‑only
"   settings below. Vundle must be installed at ~/.vim/bundle/Vundle.vim.
"----------------------------------------------------------------
set nocompatible " be iMproved, required
filetype off     " required

"Removes windows to pop-up and removes the RHS scroll bar
set guioptions+=lrbmTLce
set guioptions-=lrbmTLce
set guioptions+=c

" Include Vundle itself in the runtime path
set rtp+=~/.vim/bundle/Vundle.vim

call vundle#begin()
    " :PluginInstall     - install a plugin
    " :PluginUpdate      - update existing plugin
    " :PluginClean       - uninstall a plugin
    Plugin 'VundleVim/Vundle.vim'

    " Colour scheme and UI plugins
    Plugin 'NLKNguyen/papercolor-theme'
    Plugin 'ryanoasis/vim-devicons'
    Plugin 'powerline/powerline-fonts'       " go to /home/yehudat/.vim/bundle/powerline-fonts and run install.sh to install the fonts
    Plugin 'vim-airline/vim-airline'
    Plugin 'vim-airline/vim-airline-themes'

    " Code navigation and editing helpers
    Plugin 'vim-scripts/matchit.zip'
    Plugin 'vimtaku/hl_matchit.vim'          " extends the existing functionality of % key
    Plugin 'nachumk/systemverilog.vim'
    Plugin 'vim-scripts/mru.vim'             " :MRU
    Plugin 'vim-scripts/ctags.vim'           " exuberant tags
    Plugin 'elzr/vim-json'                   " https://github.com/elzr/vim-json
    Plugin 'Townk/vim-autoclose'             " auto-closes brackets and paratheses
    Plugin 'scrooloose/nerdcommenter'        " in normal mode press <num_of_lines><Leader>cc or <num_of_lines><Leader>cu to uncomment
    Plugin 'junegunn/vim-easy-align'         " https://github.com/junegunn/vim-easy-align
    Plugin 'majutsushi/tagbar'               " press <Shift-t>
    Plugin 'ctrlpvim/ctrlp.vim'              " https://github.com/kien/ctrlp.vim
    Plugin 'airblade/vim-gitgutter'          " :GitGutterDisable/Enable | :GitGutterLineHighlightsDisable/Enable
    Plugin 'othree/xml.vim'
    Plugin 'tpope/vim-fugitive'              " Git wrapper for VIM: see more https://github.com/tpope/vim-fugitive
    Plugin 'Yggdroot/indentLine'             " https://github.com/Yggdroot/indentLine   :IndentLinesToggle
    Plugin 'michaeljsmith/vim-indent-object' " Text-object recognition of indented objects
    Plugin 'tpope/vim-surround'              " Cmd structure: {y,c,d}s<text-object>
    Plugin 'preservim/nerdtree'
    Plugin 'Xuyuanp/nerdtree-git-plugin'
    Plugin 'tiagofumo/vim-nerdtree-syntax-highlight'
    Plugin 'vim-test/vim-test'
    Plugin 'tpope/vim-dispatch'
    Plugin 'tmhedberg/SimpylFold'
    Plugin 'github/copilot.vim'
    Plugin 'sheerun/vim-polyglot'
    Plugin 'will133/vim-dirdiff'             " :DirDiff <path1> <path2>
call vundle#end()

"================================================================
" 3. Plugin configuration
"----------------------------------------------------------------
        "Airline panel legend:
    "+-----------------------------------------------------------------------------+
    "| A | B |                     C                            X | Y | Z |  [...] |
    "+-----------------------------------------------------------------------------+
    "Section    Meaning (example)
    "      A    displays the mode + additional flags like crypt/spell/paste (INSERT)
    "      B    VCS information (branch, hunk summary) (master)
    "      C    filename + read-only flag (~/.vim/vimrc RO)
    "      X    filetype (vim)
    "      Y    file encoding[fileformat] (utf-8[unix])
    "      Z    current position in the file
    "  [...]    additional sections (warning/errors/statistics) from external plugins (e.g. YCM, syntastic, ...)
    let g:airline_theme='onedark'
    let g:airline_section_z = '%p%% Ln:%l/Cn:%v'
    let g:airline#extensions#tabline#enabled = 1              "Tabline confuguration
    let g:airline#extensions#tabline#fnamemod = ':t'          "clean filename
    let g:airline#extensions#tabline#show_close_button = 0    "No 'X' close button
    let g:airline_powerline_fonts = 1 " glyphs
    let g:airline_symbols_ascii = 0

    """"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
    "Matchit
    """"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
    runtime macros/matchit.vim
    "Use to match begin end
    let g:hl_matchit_enable_on_vim_startup = 1

    """"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
    " Ctags
    """"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
    " search for definitions in tag list (of methods/modules/..)
    set tags=$VERIF_PROJ_HOME/.repo/tags
    nmap <C-d> <C-]>

    """"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
    "Git Gutter
    """"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
    let g:gitgutter_max_signs = 500
    let g:gitgutter_map_keys  = 0
    " Speed up git diff signs update
    set updatetime=100
    " Navigation and action mappings for GitGutter
    nmap ]h <Plug>GitGutterNextHunk
    nmap [h <Plug>GitGutterPrevHunk
    nmap <Leader>ha <Plug>GitGutterStageHunk
    nmap <Leader>hr <Plug>GitGutterUndoHunk
    nmap <Leader>hv <Plug>GitGutterPreviewHunk

    set showtabline=2  "2-stand for 'always'
    set laststatus=2   "2-stand for 'always'

    """"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
    "Syntastic
    """"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
    "let g:syntastic_always_populate_loc_list = 1
    "let g:syntastic_auto_loc_list = 1
    "let g:syntastic_check_on_open = 0
    "let g:syntastic_check_on_wq = 1
    "autocmd FileType c let g:syntastic_c_checkers = (finddir('HAL', '.;') == '') ? [''] : ['checkpatch']
    "let g:syntastic_c_checkpatch_args = "--max-line-length=100"
    "let g:syntastic_c_checkpatch_exec = "$HAL_TOP/checkpatch/checkpatch.pl"

    """"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
    "vim-easy-align
    """"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
    " Example for delimeter '=' :
    "       =  Around the 1st occurrences
    "      2=  Around the 2nd occurrences
    "      *=  Around all occurrences
    "      -=  Around last occurrence
    "     **=  Left/Right alternating alignment around all occurrences
    " <Enter>  Switching between left/right/center alignment modes
    """"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
    " Start interactive EasyAlign in visual mode (e.g. vipea)
    xmap <Leader>ea <Plug>(EasyAlign)
    " Start interactive EasyAlign for a motion/text object (e.g. eaip)
    nmap <Leader>ea <Plug>(EasyAlign)

    """"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
    "Tagbar
    """"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
    let g:tagbar_compact = 1 "No help & blank lines
    nmap <M-t> :TagbarToggle<CR>

    """"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
    "CtrlP
    """"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
    "<C-j/k> up/down the list
    "<C-v/s> open horizontal/vertial split
    "<C-z>   mark file to open multiple files at once
    "<C-o>   open files marked with <C-z>
    """"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
    let g:ctrlp_use_caching = 0
    " Ignore common binary and build directories in CtrlP
    let g:ctrlp_custom_ignore = 'bin$\|build$\|node_modules$\|\.git|\.bak|\.swp|\.pyc|\.class'
    let g:ctrlp_custom_ignore = 'bin$\|build$\|node_modules$\|.git|.bak|.swp|.pyc|.class'
    "CtrlP will set its local working directory according to this variable
    " 'r' - the nearest ancestor that contains one of these directories or
    "       files: .git .hg .svn .bzr _darcs, and your own root markers
    "       defined with the g:ctrlp_root_markers option.
    " 'a' - like 'c', but only applies when the current working directory
    "       outside of CtrlP isn't a direct ancestor of the directory of
    "       the current file.
    let g:ctrlp_working_path_mode = 'ra'
    let g:ctrlp_regexp = 1
    let g:ctrlp_max_files = 0
    let g:ctrlp_max_height = 18
    let g:ctrlp_switch_buffer = 'E'

    nnoremap <Leader>ff :CtrlP<CR>
    nnoremap <Leader>fb :CtrlPBuffer<CR>
    nnoremap <Leader>ft :CtrlPTag<CR>
    nnoremap <Leader>bd :bd<CR>
    nnoremap <Leader>bn :bn<CR>

    """"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
    "NERDTree (COMMENTED OUT DUE TO A HIGH PERF PENALTY/USAGE RATIO)
    """"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
    nnoremap <Leader>nt :NERDTreeToggle<CR>

    """"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
    "IndentLine
    """"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
    nnoremap <Leader>il :IndentLinesToggle<CR>
    highlight Conceal ctermfg=239 ctermbg=NONE guifg=Grey35 guibg=NONE

    """"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
    "IndentLine
    """"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
    nmap <silent> <Leader>tn :TestNearest<CR>
    nmap <silent> <Leader>tf :TestFile<CR>
    nmap <silent> <Leader>ts :TestSuite<CR>
    nmap <silent> <Leader>tl :TestLast<CR>
    nmap <silent> <Leader>tv :TestVisit<CR>

    """"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
    "SimpyFold
    """"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
    let g:simpyfold_enable_markdown = 1

    """"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
    "Claude.vim
    """"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
    let g:claude_api_key = 'your_api_key_here'
    let g:claude_map_implement = "<Leader>ai"
    let g:claude_map_open_chat = "<Leader>ac"
    let g:claude_map_send_chat_message = "<Leader>ae"
    let g:claude_map_cancel_response   = "<Leader>ax"

    """"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
    "vim-polyglot
    """"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
    let g:vim_markdown_conceal = 0
    let g:vim_markdown_conceal_code_blocks = 0
"================================================================
" 4. User interface and search settings
"----------------------------------------------------------------
" Enable filetype detection and plugin/indent support
syntax on
filetype plugin indent on

set backspace=indent,eol,start   " backspace works on everything
set number                       " line numbers
set ignorecase                   " case‑insensitive search by default
set smartcase                    " but become case‑sensitive if pattern has uppercase
set incsearch                    " show matches while typing
set hlsearch                     " highlight search results
set showmatch                    " highlight matching brackets
set mat=2                        " blink time for showmatch (tenths of a second)

"================================================================
" 5. Colors and diff/GUI setup
"----------------------------------------------------------------
" Use different settings for diff mode vs regular editing
colorscheme PaperColor
set lines=90

if &diff
    syntax off
    highlight DiffAdd    gui=none guifg=NONE    guibg=#bada9f
    highlight DiffChange gui=none guifg=NONE    guibg=#e5d5ac
    highlight DiffDelete gui=bold guifg=#ff8080 guibg=#ffb0b0
    highlight DiffText   gui=none guifg=NONE    guibg=#8cbee2
else
    set foldmethod=syntax
    set foldenable
    set foldlevel=99
    highlight NonText ctermfg=239 guifg=gray25
    set listchars=tab:▸\ ,nbsp:␣,trail:·,eol:¶,precedes:«,extends:»
    nnoremap <Leader>hc :set list!<CR>
endif

"================================================================
" 6. Indentation, whitespace and history
"----------------------------------------------------------------
set softtabstop=4   " fine-tunes the amount of white-space to be inserted
set tabstop    =4   " specifies the width of a tab character (how many white-spaces are in a tab)
set shiftwidth =4   " determines the amount of white-spaces to insert/remove by using indentation commands in normal mode
set expandtab       " causes white-spaces of equivalent width to inserted instead of tab characters. Switch expandtab to noexpandtab to use tabs

set history=200                 " command‑line history length
set ruler                       " show cursor position in the status line
set showcmd                     " show (partially) typed command in status line
set vb                          " use visual bell instead of beeping
set sta                         " show incomplete commands (status of last search)
set et                          " use spaces when <Tab> is pressed (redundant with expandtab)
set ai                          " automatic indentation
set si                          " smart indentation
set nocin                       " disable C indentation
set nowrap                      " don't wrap long lines by default
set textwidth=0                 " allow unlimited line length
"set colorcolumn=100

" Backup and swap settings
set wb                          " keep a backup file while overwriting
set nosol                       " don't set shortmess options aggressively
set nobackup
set noswapfile

" Disable audible bells and flashing
set noerrorbells visualbell t_vb=
autocmd GUIEnter * set visualbell t_vb=

" Auto‑save on leaving insert mode
autocmd InsertLeave * update

"================================================================
" 7. Additional useful mappings
"----------------------------------------------------------------
" Toggle diff options to ignore whitespace and case
nnoremap <Leader>iw :set diffopt+=iwhite<CR>
nnoremap <Leader>ic :set diffopt+=icase<CR>
nnoremap dg :diffget 1<CR>
nnoremap dl :diffget 3<CR>

" Change working directory to the one of the current file
nnoremap <Leader>cd :cd %:p:h<CR>:pwd<CR>

" Copy full path of current file to the system clipboard
noremap <Leader>fp :let @* = expand("%:p")<CR>

" Remove the Windows ^M - when the encodings gets messed up
noremap <Leader>mw mmHmt:%s/<C-V><cr>/\r/ge<cr>'tzt'm

" Retab the current buffer (convert tabs to spaces based on settings)
nnoremap <Leader>ft :retab<CR>

" Reindent entire file using the current indentation settings
map <M-i> mzgg=G`z

" Restore cursor to last known position when opening a file
augroup restore_cursor
  autocmd!
  autocmd BufReadPost *
    \ if line("'\"") > 1 && line("'\"") <= line("$") |
        \ execute "normal! g`\"" |
    \ endif
augroup END

"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" HELP
"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
"
"""""""""""""""""""""
" HOW TO FOLD CODE?
"""""""""""""""""""""
" zm to fold more
" zr to fold less
" zc to close a fold
" zo to open it
" za to toggle between those two states
" zM to close every fold
" zR to open them

"""""""""""""""""""""
" HOW TO SCROLL CODE?
"""""""""""""""""""""
" Move a line to the top/bottom of the screen: zt/zb
" Move half screen forward/back:             : <C-u>/<C-d>

"""""""""""""""""""""
" HOW TO ACCESS REGS?
"""""""""""""""""""""
" Print all the registers and its content:
"     Command mode: :reg
" Access a reg
"     Normal mode: press "<reg-key>
"     Insert mode: press <C-r> <reg-key>
" Example:
"     Copy a line to reg '2'          : (in Normal Mode)  "2yy
"     Copy an entire buffer to reg '+': (in Normal Mode)  gg"+yG
"     Copy an entire buffer to reg 'c': (in Command Mode) :%y c

"""""""""""""""""""""
" HOW TO MANAGE WINDOWS?
"""""""""""""""""""""
" <C-w>s : horisontal split
" <C-w>v : vertical   split

"""""""""""""""""""""
" VIM native indentations tools
"""""""""""""""""""""
" gg=G    indent all the lines in a file
" =i{     indent inside a block that starts with '{'

"""""""""""""""""""""
" VIM native marks
" [A-Z] global makrs
" [a-z] local file marks
" y'<mark_letter> copy from a cursor to a mark
" d'<mark_letter> delete from a cursor to a mark
"""""""""""""""""""""

